<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if title %}{{ title }} - {% endif %}YZTA Blog</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&family=Inter:wght@400;500;600;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="{{ url_for('index') }}" class="nav-logo">
                <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo" class="logo-icon">
                <span class="logo-text">BLOG3</span>
            </a>

            <div class="nav-search">
                <form action="{{ url_for('search') }}" method="GET" class="search-form">
                    <input type="text" name="query" placeholder="Yazılarda ara..."
                        value="{{ request.args.get('query', '') }}" class="search-input">
                    <button type="submit" class="search-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                    </button>
                </form>
            </div>

            <div class="nav-links">
                {% if current_user.is_authenticated %}
                <a href="{{ url_for('create_post') }}" class="btn btn-write">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 20h9"></path>
                        <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                    </svg>
                    Yazmaya Başla
                </a>
                <div class="user-menu">
                    <button class="user-menu-btn">
                        <div class="avatar">{{ current_user.username[0].upper() }}</div>
                    </button>
                    <div class="user-dropdown">
                        <a href="{{ url_for('user_profile', username=current_user.username) }}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            Profilim
                        </a>
                        <a href="{{ url_for('logout') }}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                <polyline points="16 17 21 12 16 7"></polyline>
                                <line x1="21" y1="12" x2="9" y2="12"></line>
                            </svg>
                            Çıkış Yap
                        </a>
                    </div>
                </div>
                {% else %}
                <a href="{{ url_for('login') }}" class="nav-link">Giriş Yap</a>
                <a href="{{ url_for('register') }}" class="btn btn-primary">Başla</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="flash-container">
        {% for category, message in messages %}
        <div class="flash flash-{{ category }}">
            <span>{{ message }}</span>
            <button class="flash-close" onclick="this.parentElement.remove()">×</button>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    <!-- Main Content -->
    <main class="main-content">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <p class="footer-text">© 2026 BLOG3. Tüm hakları saklıdır.</p>
        </div>
    </footer>

    <script>
        // User dropdown toggle
        document.querySelectorAll('.user-menu-btn').forEach(btn => {
            btn.addEventListener('click', function (e) {
                e.stopPropagation();
                this.parentElement.classList.toggle('active');
            });
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function () {
            document.querySelectorAll('.user-menu').forEach(menu => {
                menu.classList.remove('active');
            });
        });

        // Like button AJAX
        document.querySelectorAll('.like-btn').forEach(btn => {
            btn.addEventListener('click', async function (e) {
                e.preventDefault();
                const postId = this.dataset.postId;
                const response = await fetch(`/post/${postId}/like`, {
                    method: 'POST',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                if (response.ok) {
                    const data = await response.json();
                    this.classList.toggle('liked', data.liked);
                    this.querySelector('.like-count').textContent = data.like_count;
                }
            });
        });

        // Auto-hide flash messages
        setTimeout(() => {
            document.querySelectorAll('.flash').forEach(flash => {
                flash.style.opacity = '0';
                setTimeout(() => flash.remove(), 300);
            });
        }, 5000);
    </script>
    {% block scripts %}{% endblock %}
</body>

</html>